<%--
    Document   : userDatesBackUpSNS
    Created on : 15-dic-2010, 13:40:16
    Author     : tote
--%>

<%@page import="es.uah.cc.ie.sources.SNSdataBaseIntegrator"%>
<%@page contentType="text/html" pageEncoding="UTF-8"%>

<%
            //Obtenemos la conexión a Facebook
            SNSdataBaseIntegrator snsDB = SNSdataBaseIntegrator.getSessionInstance(request);
            snsDB.logSession(request, response);
            String newConection = request.getParameter("newConection");
            String ok = request.getParameter("ok");
            System.out.println("NUEVA CONEXION: " + newConection);
            System.out.println("STTSNSAG: OBJETO ID: " + snsDB.getUserSettings().getUid());
            String[][] angels = null;

            if (newConection.equals("1")) {
                // Datos guardados en DB correctamente
                snsDB.setNewConnection(false);
                snsDB.setInicio(true);
                angels = snsDB.getArrayAngels();
            } else if (!snsDB.isNewConnection()) {
                // Cargamos la configuración en pantalla después de acceder a la DB
                // METODOS PARA CARGAR LA CONFIGURACION RECUPERADA
                snsDB.setInicio(true);
                angels = snsDB.getAngels();
                snsDB.setArrayAngels(angels);
            } else {
                // Nuevo usuario
                snsDB.setInicio(true);
                angels = snsDB.getAngels();
                snsDB.setArrayAngels(angels);
            }

            String[] localeMenu = snsDB.getLocaleSettings().stringToArray(snsDB.getLocaleSettings().getTitleMenSettings());
            String[] titleHelp = snsDB.getLocaleSettings().stringToArray(snsDB.getLocaleSettings().getHelpMe());
            String[] menLoader = snsDB.getLocaleSettings().stringToArray(snsDB.getLocaleSettings().getWarnings());
            String titleFbList = snsDB.getLocaleSettings().getTitleFbListSettAng();
            String titleAngelSettAng = snsDB.getLocaleSettings().getSubTitleAngelSettAng();
            String mensaje = menLoader[1];
            String menSave = menLoader[2];
            String menWait = menLoader[4];

            // EMAIL PRUEBA FB
            snsDB.emailPrueba();
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"lang="es" xml:lang="es">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
        <title><%=snsDB.getLocaleSettings().getTitleSettings()%></title>

        <!--import css -->
        <link rel="stylesheet" type="text/css" href="Styles/Style.css" />
        <link rel="stylesheet" type="text/css" href="Styles/facebook.css" />
        <link rel="stylesheet" type="text/css" href="Styles/fcbklistselection.css" />
        <link rel="stylesheet" type="text/css" href="Styles/jquery.loader.css" />

        <!--import jquery lib -->
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/jquery.corner.js"></script>
        <script type="text/javascript" src="js/AjaxFlagMenu-1.0.2.min.js"></script>

        <script type="text/javascript" src="js/fcbklistselection.js"></script>
        <script type="text/javascript" src="js/utilidadesFormularios.js"></script>
        <script type="text/javascript" src="js/jquery.loader.js"></script>

        <script type="text/javascript">
            //jQuery.noConflict();
            function cargaMenu(){
                jQuery(document).ready(function(){
                    var Menu = jQuery("#Menu").AjaxFlagMenu({
                        Caption:'<%= localeMenu[0]%>',
                        CaptionClass:'CaptionClass',
                        onOutClass:'onOutClass',
                        onOverClass:'onOverClass',
                        onClickClass:'onClickClass',
                        hscOutClass:'hscOutClass',
                        hscClickClass:'hscClickClass',
                        Loading_gif:'http://oe.dynalias.net:8080/SNSAngelGuardFB/resources/Loading.gif',
                        ajaxContent:'ajaxContent'
                    });
                    //Angels
                    var Angels = Menu.add({
                        Title:'<%= localeMenu[1]%>',
                        onOutIcon:'http://oe.dynalias.net:8080/SNSAngelGuardFB/resources/icono_mini.gif',
                        onClickIcon:'http://oe.dynalias.net:8080/SNSAngelGuardFB/resources/icono_mini.gif',
                        HtmlSatusContent:'',
                        url:'http://oe.dynalias.net:8080/SNSAngelGuardFB/settingsSNSAngelGuard_Angels.jsp',
                        data:'<%= snsDB.arrayToString(angels)%>'
                    });
                    Angels.sethscCorner();
                    //Vigilants
                    var Vigilants = Menu.add({
                        Title:'<%= localeMenu[2]%>',
                        onOutIcon:'http://oe.dynalias.net:8080/SNSAngelGuardFB/resources/icono2_mini.gif',
                        onClickIcon:'http://oe.dynalias.net:8080/SNSAngelGuardFB/resources/icono2_mini.gif',
                        HtmlSatusContent:'',
                        url:'http://oe.dynalias.net:8080/SNSAngelGuardFB/settingsSNSAngelGuard_Vigilants.jsp',
                        data:''
                    });
                    Vigilants.sethscCorner();
                    jQuery("#Menu").corner("4px");
                    jQuery("#ajaxContent").corner("4px");

                    Angels.cargaInicio('http://oe.dynalias.net:8080/SNSAngelGuardFB/settingsSNSAngelGuard_Angels.jsp',
                    '<%= titleFbList%>',
                    '<%= titleAngelSettAng%>',
                    '<%= snsDB.getLocaleSettings().getTxtNameTutorSettAng()%>',
                    '<%= snsDB.getLocaleSettings().getTxtEmailTutorSettAng()%>',
                    '<%= menLoader[3]%>','<%= menLoader[4]%>','<%= menLoader[0]%>');

                });
            }
        </script>
    </head>
    <body onload="cargaMenu();mostrarMenOk('<%= newConection%>','<%= ok%>','<%= mensaje%>');">
        <form id="frBackUp" method="" action="">
            <input type="hidden" id="h1" name="h1" value="" />
            <input type="hidden" id="h2" name="h2" value="" />
            <input type="hidden" id="h3" name="h3" value="" />
            <input type="hidden" id="h4" name="h4" value="" />
            <input type="hidden" id="h5" name="h5" value="" />
            <input type="hidden" id="h6" name="h6" value="" />
            <input type="hidden" id="h7" name="h7" value="" />
            <input type="hidden" id="h8" name="h8" value="" />
            <input type="hidden" id="h9" name="h9" value="" />
            <input type="hidden" id="h10" name="h10" value="" />
            <input type="hidden" id="h11" name="h11" value="" />
            <input type="hidden" id="h12" name="h12" value="" />
            <input type="hidden" id="h13" name="h13" value="" />
            <input type="hidden" id="h14" name="h14" value="" />
            <input type="hidden" id="h15" name="h15" value="" />
            <input type="hidden" id="h16" name="h16" value="" />

            <div id="settings" style="width:97%;">
                <center>
                    <div id="container">
                        <table style="width:80%;height: 90%;">
                            <tr>
                                <td></td>
                            </tr>
                            <tr>
                                <td width="20%" style="vertical-align:top;">
                                    <div id="Menu">
                                    </div>
                                    <A class="linkHelp" onclick="lanzarModalAyuda('http://oe.dynalias.net:8080/SNSAngelGuardFB/helpMe.jsp',700,420);">
                                        <h1 class="letraNorm"><%= titleHelp[0]%></h1>
                                    </A>
                                </td>
                                <td width="80%" style="vertical-align:top;">
                                    <div id="ajaxContent">
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div id="botoneraInferior" style="width:80%;" align="left" margin="15px">
                        <hr class="linea" />
                        <table>
                            <tr>
                                <td></td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="button" class="boton" id="btnSave" name="btnSave" value="<%= snsDB.getLocaleSettings().getBtnSaveCheckSettings()%>"
                                           onclick="saveSettings('<%= menSave%>','<%= menWait%>');"/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </center>
            </div>
        </form>
    </body>
</html>
